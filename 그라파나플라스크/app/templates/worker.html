<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon - Blog Template</title>
    
    <style>
        /* styles.css */

            /* 기본 설정 --------------------------------------------*/
            body {
                margin: 0;
                font-family: Arial, sans-serif;
                color: #333;
                background-color: #f5f5f5;
            }

            .container {
                display: flex;
                min-height: 100vh;
            }

            /*yes mate 로고 섹션 스타일 -----------------------------------------------*/
            .logo-container {
                display: flex; /* Flexbox 사용 */
                justify-content: center; /* 수평 정렬 */
                align-items: center; /* 수직 정렬 */
                margin-bottom: 30px;
                height: 100px; /* 로고 섹션 높이 설정 (필요시 조정) */
                margin-bottom: 15px; /* 로고와 다른 요소 사이 간격 */
                transform: translateX(-10px); /* 왼쪽으로 10px 이동 */
                
            }

            .logo-container img {
                
                width: 170%; /* 로고 크기 조정 */
                height: auto;
                border-radius: 50%; /* 둥근 테두리 */
            }

            /* Sidebar 스타일 ------------------------------------------- */
            .sidebar {
                width: 18%; /* 사이드바 너비 */
                background-color: #222222ee;
                color: #ffffff;
                padding: 20px;
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* 상단 정렬 */
                align-items: flex-start; /* 왼쪽 정렬 */
                text-align: left; /* 텍스트 왼쪽 정렬 */
            }

            /* 제목 스타일 */
            .sidebar h1 {
                font-size: 24px;
                margin-bottom: 10px;
            }

            /* 설명 텍스트 스타일 */
            .sidebar p {
                font-size: 14px;
                line-height: 1.5;
                margin-bottom: 20px;
            }

            /* 메뉴 스타일 */
            .sidebar .menu ul {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .sidebar .menu li {
                margin-bottom: 10px;
            }

            .sidebar .menu a {
                color: #fff;
                text-decoration: none;
                font-size: 20px;
            }

            .sidebar .menu a:hover {
                text-decoration: underline;
            }

       
            /* 소셜 링크 스타일 */
            .sidebar {
                display: flex;
                flex-direction: column; /* 세로 정렬 */
                align-items: center; /* 내부 요소 가운데 정렬 */
            }

            .sidebar .social-links {
                display: flex;
                justify-content: center; /* 수평 가운데 정렬 */
                gap: 20px; /* 링크 간 간격 */
                margin-top: 20px;
            }

            .sidebar .social-links a img {
                width: 20px;
                height: 20px;
}

            /* 홈모양 스타일 -------------------------------------------*/

            .h2-container {
                display: flex;
                align-items: center;
                justify-content: space-between;
                position: relative; /* 부모 요소가 이미지를 기준으로 정렬 가능 */
            }

            .h2-container h2 {
                flex: 1;
                text-align: center;
                margin-right: 10px; /* Adjust spacing between text and image */
            }

            .h2-container .h2-image {
                width: 50px; /* Adjust size as needed */
                height: 42px; /* Adjust size as needed */

            }


            .h2-image {
        
                height: auto;
                margin-left: 10px; /* 텍스트와 간격 */
            }

            /* Main Content 스타일 -------------------------------------------*/
            .content {
                width: 75%;
                padding: 20px;
                background-color: #fff;
            }

            .post {
                margin-bottom: 20px;
            }

            .post h2 {
                font-size: 24px;
                margin-bottom: 5px;
            }

            .post .meta {
                font-size: 14px;
                color: #888;
                margin-bottom: 10px;
            }

            .post p {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 10px;
            }


            /* 검은색박스 구분선 스타일 -----------------------------------------*/

            .divider {
                border: none; /* 기본 테두리 제거 */
                border-top: 1.5px solid #676767; /* 선 색상과 두께 설정 */
                margin: 50px 0; /* 위아래 여백 설정 */
                width: 100%; /* 선 너비를 사이드바에 맞게 */
            }
    
            /* main구분선 스타일 -----------------------------------------*/
            .divider2 {
                border: none; /* 기본 테두리 제거 */
                border-top: 1.5px solid #c6c6c6; /* 선 색상과 두께 설정 */
                margin-top: 40px; /* 위쪽 여백 설정 */
                margin-bottom: 30px; /* 아래쪽 여백을 더 크게 설정 */
                width: 100%; /* 선 너비를 사이드바에 맞게 */
            }


            /* 반응형 디자인 --------------------------------*/
            @media (max-width: 768px) {
                .container {
                    flex-direction: column;
                }

                .sidebar {
                    width: 100%;
                }

                .content {
                    width: 100%;
                }
            }



                    /* 맨 밑ㅇㅔ 글자 --------------------------------------------------------------------*/
        /* Footer를 화면 하단에 고정 */

            footer {
                border-top: 1px solid #000000; /* 위쪽에 얇은 선 추가 */
                padding-top: 10px; /* 선과 내용 사이의 간격 추가 */
                position: fixed; /* 화면 하단에 고정 */
                bottom: 0; /* 창의 하단에 위치 */
                left: 0; /* 왼쪽 정렬 */
                width: 100%; /* 화면 전체 너비 */
                display: flex; /* Flexbox 활성화 */
                flex-direction: row; /* 가로 정렬 */
                justify-content: center; /* 가운데 정렬 */
                align-items: center; /* 세로축 가운데 정렬 */
                padding: 10px 20px; /* 여백 */
                background-color: #4b4a48f9; /* 배경색 */
                color: #000; /* 텍스트 색상 */
                z-index: 1000; /* 다른 요소 위로 배치 */
                box-sizing: border-box; /* 패딩 포함 */
                gap: 30px; /* 두 요소 간 간격 */
            }

            
            footer .footer-bottom {
                display: flex; /* Flexbox 활성화 */
                align-items: center; /* 세로축 가운데 정렬 */
                text-align: center; /* 텍스트 가운데 정렬 */
            }

            footer .footer-bottom {
                margin-left: 20px; /* 좌측 여백 */
                font-size: 13px; /* 글씨 크기 */
                color: #ffffff; /* 글씨 색상 */
            }
            footer a {
                    text-decoration: none; /* 링크의 밑줄 제거 */
            }
            footer a img {
                vertical-align: middle; /* 이미지가 텍스트와 수직으로 맞춰지도록 설정 */
            }
           
            

            /* 기본 리스트 스타일 ---------- 이 */
       
            .menu{
                width:100%;
            }
            
            ul {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            /* 리스트 아이템 스타일 */
            ul > li {
                position: relative;
                margin-bottom: 10px;
            }

            /* 드롭다운 부모 스타일 */
            .dropdown {
                position: relative;
            }

            /* 드롭다운 메뉴 기본 숨김 */
            .dropdown-menu {
                display: none; /* 기본적으로 숨김 */
                background-color: #00000000;
                padding: 10px 0;
                list-style: none;
                margin: 0;
                position: relative;
            }

            /* 드롭다운 메뉴 항목 스타일 */
            .dropdown-menu li {
                padding: 5px 20px;
                position: relative;
            }


            /* 드롭다운 클릭 시 표시 */
            .dropdown:focus-within .dropdown-menu {
                display: block;
            }

            /* 서브 드롭다운 스타일 */
            .sub-dropdown .date-picker {
                display: none;
                margin-top: 10px;
            }

            .sub-dropdown:focus-within .date-picker {
                display: block;
            }

            /* 날짜 입력 칸 스타일 ----------------------------------------------------------------------*/
            .date-picker input {
                font-size: 14px; /* 글씨 크기를 16px로 증가 */
                padding: 8px; /* 내부 여백을 더 늘려서 입력 칸 크기 확대 */
                border: 1px solid #ccc; /* 테두리 스타일 유지 */
                border-radius: 5px; /* 테두리를 조금 더 둥글게 */
                width: 240px; /* 날짜 입력 칸의 너비 확대 */
                max-width: 80%; /* 화면 크기에 따라 입력 칸이 줄어들도록 설정 */
                box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1); /* 입력 칸에 살짝 그림자 추가 */
                transition: border-color 0.3s, box-shadow 0.3s; /* 포커스 시 부드러운 애니메이션 */
            }

            /* 포커스 상태에서 스타일 변경 */
            .date-picker input:focus {
                border-color: #4CAF50; /* 포커스 시 테두리 색상을 녹색으로 변경 */
                box-shadow: 0px 2px 8px rgba(0, 128, 0, 0.3); /* 포커스 시 그림자 강조 */
                outline: none; /* 기본 포커스 스타일 제거 */
            }


           /* 버튼 -------------------------------------------------------------------------- 스타일 */


            button {
                background-color: #0163d38a; /* 버튼 배경색 (녹색) */
                color: white; /* 버튼 글자색 */
                padding: 5px 10px; /* 버튼 내부 여백 (작게 설정) */
                border: 1px solid #ffffff; /* 흰색 테두리 추가 */
                border-radius: 5px; /* 둥근 모서리 */
                font-size: 16px; /* 글자 크기 */
                cursor: pointer; /* 마우스 커서를 포인터로 변경 */
                transition: background-color 0.3s, transform 0.2s; /* 호버 및 클릭 애니메이션 */
                position: relative; /* 위치 조정을 위해 추가 */
                margin-top: 5px; /* 버튼을 아래로 이동 */
                display: inline-block; /* 버튼이 테이블 안에서 고정 */
            }



                        /* 드롭다운 메뉴 스타일 */
            .dropdown-menu {
                padding: 10px; /* 내부 여백 추가 */
            }

            /* 모델 재학습과 시작 날짜 간 공간 추가 */
            .date-picker form {
                margin-top: 20px; /* 폼 상단에 20px 여백 */
            }
            button:hover {
                background-color: #ffab24; /* 호버 시 버튼 배경색 */
            }

            button:active {
                transform: scale(0.95); /* 클릭 시 버튼 살짝 축소 */
            }

            button:disabled {
                background-color: #ccc; /* 비활성화된 버튼 색상 */
                cursor: not-allowed; /* 비활성화된 버튼 커서 */
            }
            /* 중량 ,rpm */
        .stat-container {
            display: flex;
            justify-content: center;
            text-align: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .stat-container div {
            font-size: 48px; /* 글자 크기 */
            font-weight: bold;
            color: #4caf50; /* 기본 색상 */
        }

        .stat-box {
            width: 150px; /* 박스 너비 */
            height: 60px; /* 박스 높이 */
            text-align: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-box h3 {
            margin: 0;
            font-size: 16px;
            color: #555;
        }

        .stat-box p {
            margin: 5px 0 0;
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .graph-container {
            margin-top: 20px; /* 위와의 간격 추가 */
            padding: 20px; /* 내부 여백 */
            border: 1px solid #ddd; /* 테두리 */
            border-radius: 10px; /* 모서리 둥글게 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 박스 그림자 */
            background-color: #fff; /* 배경색 */
            text-align: center;
            max-width: 1000px; /* 최대 너비 제한 */
            margin-left: auto; /* 가운데 정렬 */
            margin-right: auto;
        }

        .graph-container h2 {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px; /* 그래프 제목 아래 간격 */
        }

        .gauge-container {
            display: flex;
            justify-content: center;
            margin-top: -40px; /* 기존 50px에서 20px로 간격 조정 */
            gap: 60px; /* 게이지 간의 간격 추가 */
            
        }

        .gauge {
            text-align: center;
            width: 200px;
        }

        .gauge canvas {
            width: 100%;
        }

        .gauge p {
            font-size: 20px;
            margin-top:-20px;
        }
        .current-time {
            color: #ffffff; /* 글자색은 흰색 */
            text-align: center; /* 가운데 정렬 */
            font-size: 16px; /* 글자 크기 키움 */
            margin: 10px 0; /* 상하 여백 추가 */
            font-weight: bold; /* 글자 두께 추가 */
        }




                    </style>
                 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                 <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
               </head>
               <body>
            
                <div class="container">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <!-- Logo Section -->
                        <div class="logo-container">
                            <img src="../static/images/로고흰색mate.png"  alt="Logo" >
                        </div>
                        <h1>작업자</h1>
                        <p>MES and various solutions specialized for manufacturing sites ensure successful project performance</p>
                         <!-- 구분선 추가 -->
                        <hr class="divider">
                        <nav class="menu">

                            <div class="current-time">
                                <a>현재 시간</a>
                                <br>
                                <a id="currentTime" ></a>
                            </div>
                         
                        </nav>
                        <!-- 구분선 추가 -->
                        <hr class="divider">
                        <div class="social-links">
                                 <a href="https://facebook.com" target="_blank">
                                     <img src= "../static/images/facebook.png" alt="Facebook">
                                 </a>
                                 <a href="https://twitter.com" target="_blank">
                                     <img src="../static/images/twitter X.png" alt="Twitter">
                                 </a>
                                 <a href="https://instagram.com" target="_blank">
                                     <img src="../static/images/instagram.png" alt="Instagram">
                                 </a>
                                 <a href="https://youtube.com" target="_blank">
                                     <img src="../static/images/youtube.png" alt="YouTube">
                                 </a>
                                 <a href="https://accounts.kakao.com/" target="_blank">
                                     <img src="../static/images/kakao.png" alt="KakaoTalk">
                                 </a>
                                 <a href="https://blog.naver.com/computermate" target="_blank">
                                     <img src="../static/images/naver blog.png" alt="Blog">
                                 </a>
                             </div>
                    </aside>
                    <main class="content">
         
                        <article class="post">
                            <div class="h2-container">
                                <h2 >  실시간 대시보드 </h2>
                                <a href="/" class="button-link">
                                    <img class="h2-image" src="../static/images/홈버튼.png" alt="Example Button">
                                </a>
                            </div>
                                       <!-- 구분선 추가 -->
                                       <hr class="divider2">            
                    <!-- Main Content -->
                    <main>
                        <!-- 중량값 표시 -->
                    <div class="stat-container">
                        <div class="stat-box">
                            <h3>실제 중량</h3>
                            <p id="current-weight">Loading...</p>
                        </div>
            
                        <div class="stat-box">
                            <h3>예측 중량</h3>
                            <p id="current-pre_weight">Loading...</p>
                        </div>
            
                        <div class="stat-box">
                            <h3>실제 rpm</h3>
                            <p id="current-rpm">Loading...</p>
                        </div>
            
                        <div class="stat-box">
                            <h3>최적 rpm</h3>
                            <p id="optimal-rpm">Loading...</p>
                        </div>
                    </div>
            
                    <div class="graph-container">
                        <div style="width: 1000px; height: 400px;  margin: 0 auto;">
            
                            <canvas id="weightChart" width="150%" height="60%"></canvas>
                        </div>
                    </div>
            
                        <!-- 게이지 차트 -->
                    <section class="gauge-container">
                        <div class="gauge">
                            <canvas id="gaugeChart1"></canvas>
                            <p>챔버 온도</p>
                        </div>
                        <div class="gauge">
                            <canvas id="gaugeChart2"></canvas>
                            <p>사출 온도</p>
                        </div>
                        <div class="gauge">
                            <canvas id="gaugeChart3"></canvas>
                            <p>스크류 온도</p>
                        </div>
                        <div class="gauge">
                            <canvas id="gaugeChart4"></canvas>
                            <p>압출 방식</p>
                        </div>
                    </section>
                </main>
                   

                   <footer>
    
       
                 
                    <div class="footer-bottom">
                         © 2024 yes!mate(yi-hyun, ji-won, jae-ung, dong-gun) ♥이멤버리멤버♥
                   </div>
            
            
                    </footer>
                    <script>
                        const ctx = document.getElementById('weightChart').getContext('2d');
                        const weightChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: [], // 시간 레이블
                                datasets: [{
                                    label: '실제 중량',
                                    data: [], // 중량 값
                                    borderColor: 'green',
                                    borderWidth: 2,
                                    pointRadius: 0,
                                    tension: 0.4
                                },
                                {
                                    label: '예측 중량',
                                    data: [], // 예측중량 값
                                    borderColor: 'blue',
                                    borderWidth: 2,
                                    pointRadius: 0,
                                    tension: 0.4,
                                    spanGaps: true
                                },
                                {
                                    label: '최적 중량',
                                    data: [], // 최적중량 값
                                    borderColor: 'orange',
                                    borderWidth: 2,
                                    pointRadius: 0,
                                    tension: 0.4,
                                    spanGaps: true
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    x: {
                                        type: 'time',
                                        time: {
                                            unit: 'second',
                                            tooltipFormat: 'yyyy-MM-dd HH:mm:ss',
                                            displayFormats: {
                                                second: 'HH:mm:ss'
                                            }
                                        },
                                        title: {
                                            display: true,
                                            text: '시간'
                                        }
                                    },
                                    y: {
                                        beginAtZero: false,
                                        min: 2.5,
                                        max: 3.8,
                                        title: {
                                            display: true,
                                            text: '중량(g)'
                                        }
                                    }
                                }
                            }
                        });
                    
                        // 게이지 차트 생성 함수
                        function createGaugeChart(canvasId, initialValue, color) {
                            const ctx = document.getElementById(canvasId).getContext('2d');
                            const chart = new Chart(ctx, {
                                type: 'doughnut',
                                data: {
                                    datasets: [{
                                        data: [initialValue, 100 - initialValue],
                                        backgroundColor: [color, '#E0E0E0'],
                                        borderWidth: 0,
                                    }]
                                },
                                options: {
                                    rotation: -90, // 시작 각도
                                    circumference: 180, // 반원
                                    cutout: '70%', // 중앙 구멍 크기
                                    plugins: {
                                        tooltip: { enabled: false } // 툴팁 비활성화
                                    }
                                },
                                plugins: [{
                                    id: 'textPlugin',
                                    beforeDraw(chart) {
                                        const { width } = chart;
                                        const ctx = chart.ctx;
                                        const text = chart.config.data.text || `${initialValue.toFixed(1)} °C`;
                    
                                         // 텍스트 색상 조건
                                        const latestCTemp = chart.data.datasets[0].data[0];
                                        const textColor = latestCTemp >= 70 ? 'orange' : '#4CAF50'; // 70도 이상이면 주황색, 미만이면 초록색
                                        
                                        ctx.save();
                                        ctx.font = 'bold 24px Arial';
                                        ctx.textBaseline = 'middle';
                                        ctx.textAlign = 'center';
                                        ctx.fillStyle = textColor;
                    
                                        // 중앙 텍스트 위치 계산
                                        const centerX = width / 2;
                                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 1.5;
                                        ctx.fillText(text, centerX, centerY);
                                    }
                                }]
                            });
                    
                            return chart;
                        }
                    
                        // 게이지 차트 초기화
                        const gaugeChart1 = createGaugeChart('gaugeChart1', 0, '#4CAF50'); // 챔버 온도
                        const gaugeChart2 = createGaugeChart('gaugeChart2', 0, '#4CAF50'); // 사출 온도
                        const gaugeChart3 = createGaugeChart('gaugeChart3', 0, '#4CAF50'); // 스크류 온도
                        const gaugeChart4 = createGaugeChart('gaugeChart4', 0, '#4CAF50'); // 스크류  
                
                        async function fetchData() {
                            try {
                                const response = await fetch('/get-data');
                                const data = await response.json();
                                
                                // 데이터를 정렬 (timestamp 기준으로 오름차순 정렬)
                                const sortedData = data.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                                // 중복 제거 (중복된 timestamp 제거)
                                const uniqueData = sortedData.filter((item, index, arr) =>
                                    index === 0 || item.timestamp !== arr[index - 1].timestamp
                                    );
                                const timestamps = uniqueData.map(item => {
                                    const utcDate = new Date(item.timestamp);
                                    const adjustedDate = new Date(utcDate.getTime() - 9 * 60 * 60 * 1000); // 9시간 빼기
                                    return adjustedDate;
                                });
                            
                                const weights = uniqueData.map(item => item.scale_pv);
                                
                                const pred_weights = uniqueData.map((item, index, arr) => {
                                    if (item.predicted_scale_pv !== null) {
                                        return item.predicted_scale_pv; // 값이 있으면 그대로 사용
                                    } else if (index > 0) {
                                        return arr[index - 1].predicted_scale_pv; // 값이 없으면 이전 값으로 채움
                                    } else {
                                        return NaN; // 첫 번째 값이 없으면 NaN으로 설정
                                    }
                                });
                
                                const optimal_weights = uniqueData.map((item, index, arr) => {
                                    if (item.optimal_weight !== null) {
                                        return item.optimal_weight; // 값이 있으면 그대로 사용
                                    } else if (index > 0) {
                                        return arr[index - 1].optimal_weight; // 값이 없으면 이전 값으로 채움
                                    } else {
                                        return NaN; // 첫 번째 값이 없으면 NaN으로 설정
                                    }
                                });
                
                                const rpms = data.map(item => item.k_rpm_pv); // RPM 데이터 추가
                                const cTemps = data.map(item => item.c_temp_pv);
                                const nTemps = data.map(item => item.n_temp_pv);
                                const sTemps = data.map(item => item.s_temp_pv);
                                const Escr = data.map(item => item.E_scr_pv);
                
                                // 최적 RPM 계산
                                const optimal_rpms = data.map((item, index) => {
                                    const predicted_weight = pred_weights[index];
                                    if (predicted_weight !== null) {
                                        if (predicted_weight >= 3.05) {
                            // 3.05g 이상일 경우 추가 RPM 계산
                                        const additional_rpm = Math.ceil((predicted_weight - 3.05) / 0.05);
                                        return item.k_rpm_pv + additional_rpm; // 현재 RPM + 추가 RPM
                                    } else if (predicted_weight < 3.00) {
                                        // 3g 미만일 경우 감소할 RPM 계산
                                        const reduction_rpm = Math.ceil((3.00 - predicted_weight) / 0.05);
                                        return item.k_rpm_pv - reduction_rpm; // 현재 RPM - 감소 RPM
                                    }
                                }
                                return item.k_rpm_pv; // 예측 중량이 3.00g ~ 3.05g 범위 내이거나 null인 경우 현재 RPM 유지
                                });
                
                                // 중량값 업데이트
                                const currentWeightElement = document.getElementById('current-weight');
                                if (weights.length > 0) {
                                    const latestWeight = weights[weights.length - 1];
                                    currentWeightElement.textContent = `${latestWeight.toFixed(2)} g`;
                    
                                    // 글자 색상 변경
                                    if (latestWeight > 3.1) {
                                        currentWeightElement.style.color = 'orange';
                                    } else if (latestWeight >= 2.9 && latestWeight <= 3.1) {
                                        currentWeightElement.style.color = '#4caf50';
                                    } else {
                                        currentWeightElement.style.color = 'gray';
                                    }
                                } else {
                                    currentWeightElement.textContent = "No Data";
                                    currentWeightElement.style.color = 'gray';
                                }
                
                                //예측중량업데이트
                                const currentpreWeightElement = document.getElementById('current-pre_weight');
                                if (pred_weights.length > 0) {
                                    const latestpreWeight = pred_weights[pred_weights.length - 1];
                                    currentpreWeightElement.textContent = `${latestpreWeight.toFixed(3)} g`;
                    
                                    // 글자 색상 변경
                                    if (latestpreWeight > 3.1) {
                                        currentpreWeightElement.style.color = 'orange';
                                    } else if (latestpreWeight >= 2.9 && latestpreWeight <= 3.1) {
                                        currentpreWeightElement.style.color = '#4caf50';
                                    } else {
                                        currentpreWeightElement.style.color = 'gray';
                                    }
                                } else {
                                    currentpreWeightElement.textContent = "No Data";
                                    currentpreWeightElement.style.color = 'gray';
                                }                
                
                                // RPM값 업데이트
                                const currentRpmElement = document.getElementById('current-rpm');
                                if (rpms.length > 0) {
                                    const latestRpm = rpms[rpms.length - 1];
                                    currentRpmElement.textContent = `${latestRpm} RPM`;
                                    if (latestRpm >= 190) {
                                        currentRpmElement.style.color = 'red'; 
                                    } else if (latestRpm >= 180) {
                                        currentRpmElement.style.color = 'orange'; 
                                    } else {
                                        currentRpmElement.style.color = '#4caf50'; // 기본 초록색
                                    }
                                } else {
                                    currentRpmElement.textContent = "No Data";
                                    currentRpmElement.style.color = 'gray';
                                }
                                
                                const optimalRpmElement = document.getElementById('optimal-rpm');
                                if (optimal_rpms.length > 0) {
                                    const latestOptimalRpm = optimal_rpms[optimal_rpms.length - 1];
                                    optimalRpmElement.textContent = `${latestOptimalRpm} RPM`;
                                    if (latestOptimalRpm >= 190) {
                                        optimalRpmElement.style.color = 'red'; 
                                    } else if (latestOptimalRpm >= 180) {
                                        optimalRpmElement.style.color = 'orange'; 
                                    } else {
                                        optimalRpmElement.style.color = '#4caf50'; // 기본 초록색
                                    }
                                } else {
                                    optimalRpmElement.textContent = "No Data";
                                    optimalRpmElement.style.color = 'gray';
                                }
                                // 게이지 차트 업데이트
                                if (cTemps.length > 0) {
                                    const latestCTemp = cTemps[cTemps.length - 1]; 
                                    //색상 결정
                                    const color = latestCTemp >= 70 ? 'orange' : '#4CAF50'; // 70도 이상이면 주황색, 미만이면 초록색
                                    //데이터 업데이트
                                    gaugeChart1.data.datasets[0].data = [latestCTemp, 100 - latestCTemp];
                                    gaugeChart1.data.datasets[0].backgroundColor = [color, '#E0E0E0']; // 동적으로 색상 변경
                                    gaugeChart1.config.data.text = `${latestCTemp.toFixed(1)} °C`; // 중앙 텍스트 업데이트
                                    gaugeChart1.update();
                                }
                    
                                if (nTemps.length > 0) {
                                    const latestNTemp = nTemps[nTemps.length - 1];
                                    const color = latestNTemp >= 70 ? 'orange' : '#4CAF50';
                                    gaugeChart2.data.datasets[0].data = [latestNTemp, 100 - latestNTemp];
                                    gaugeChart2.data.datasets[0].backgroundColor = [color, '#E0E0E0'];
                                    gaugeChart2.config.data.text = `${latestNTemp.toFixed(1)} °C`; // 중앙 텍스트 업데이트
                                    gaugeChart2.update();
                                }
                    
                                if (sTemps.length > 0) {
                                    const latestSTemp = sTemps[sTemps.length - 1];
                                    const color = latestSTemp >= 70 ? 'orange' : '#4CAF50';
                                    gaugeChart3.data.datasets[0].data = [latestSTemp, 100 - latestSTemp];
                                    gaugeChart3.data.datasets[0].backgroundColor = [color, '#E0E0E0'];
                                    gaugeChart3.config.data.text = `${latestSTemp.toFixed(1)} °C`; // 중앙 텍스트 업데이트
                                    gaugeChart3.update();
                                }
                
                                if (Escr.length > 0) {
                                    const latestEscr = Escr[Escr.length - 1];
                                    const color = latestEscr >= 9 ? 'orange' : '#4CAF50';
                                    gaugeChart4.data.datasets[0].data = [latestEscr, 10 - latestEscr];
                                    gaugeChart4.data.datasets[0].backgroundColor = [color, '#E0E0E0'];
                                    gaugeChart4.config.data.text = `${latestEscr}`; // 중앙 텍스트 업데이트
                                    gaugeChart4.update();
                                }                
                
                                // Chart.js 업데이트
                                weightChart.data.labels = timestamps;
                                weightChart.data.datasets[0].data = weights;
                                weightChart.data.datasets[1].data = pred_weights;
                                weightChart.data.datasets[2].data = optimal_weights;
                                weightChart.update();
                            } catch (error) {
                                console.error('Error fetching data:', error);
                            }
                        }
                    
                        // 5초마다 데이터 갱신
                        setInterval(fetchData, 5000);
                        fetchData();

                        function updateTime() {
                            const now = new Date();
                            const formattedTime = now.toLocaleString("ko-KR", {
                                year: "numeric",
                                month: "2-digit",
                                day: "2-digit",
                                hour: "2-digit",
                                minute: "2-digit",
                                second: "2-digit",
                            });
                            document.getElementById("currentTime").innerText = `${formattedTime}`;
                        }

                        // 1초마다 시간 업데이트
                        setInterval(updateTime, 1000);

                        // 페이지 로드 시 즉시 시간 표시
                        updateTime();

                    </script>
                
               </body>
               </html>
